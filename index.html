<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Smart Recipe Generator</title>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.11.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet@2.1.0/dist/mobilenet.min.js"></script>
<style>
  :root {
    --bg: #fafafa;
    --card: #fff;
    --accent: #4CAF50;
    --text: #222;
    --border: #ddd;
    --radius: 10px;
  }
  body {
    font-family: 'Segoe UI', Roboto, Arial, sans-serif;
    background: var(--bg);
    color: var(--text);
    margin: 0;
    padding: 1rem;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  h1 {
    color: var(--accent);
    margin-bottom: 0.5rem;
  }
  .container {
    width: 100%;
    max-width: 700px;
  }
  .card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    padding: 1rem 1.2rem;
    margin: 1rem 0;
  }
  input[type="text"], select, input[type="file"] {
    padding: 0.5rem;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    width: 100%;
    box-sizing: border-box;
    font-size: 0.95rem;
  }
  button {
    background: var(--accent);
    color: white;
    border: none;
    border-radius: var(--radius);
    padding: 0.5rem 1rem;
    font-size: 0.95rem;
    cursor: pointer;
    transition: background 0.2s;
  }
  button:hover { background: #43a047; }
  .row { display: flex; gap: 0.5rem; flex-wrap: wrap; margin-top: 0.5rem; }
  .badge {
    background: var(--accent);
    color: white;
    border-radius: var(--radius);
    padding: 0.3rem 0.6rem;
    font-size: 0.8rem;
    display: inline-block;
    margin: 0.2rem;
  }
  .recipe {
    border-top: 1px solid var(--border);
    margin-top: 0.8rem;
    padding-top: 0.8rem;
  }
  .recipe h3 { margin: 0; color: var(--accent); }
  small { color: #555; }
  #labels { color: #444; margin-top: 0.5rem; }
</style>
</head>
<body>
  <div class="container">
    <h1>ü•ó Smart Recipe Generator</h1>
    <p style="color:#666">Upload an ingredient photo or type ingredients to find matching recipes!</p>

    <div class="card">
      <h2>1Ô∏è‚É£ Upload Ingredient Photo</h2>
      <input id="photo" type="file" accept="image/*"/>
      <div id="labels"></div>
      <small>Powered by TensorFlow.js MobileNet ‚Äî runs fully in your browser.</small>
    </div>

    <div class="card">
      <h2>2Ô∏è‚É£ Your Ingredients</h2>
      <div class="row">
        <input id="ingAdd" type="text" placeholder="Type ingredient and press Add"/>
        <button id="addBtn">Add</button>
        <button id="clearBtn" style="background:#999">Clear</button>
      </div>
      <div id="ings" style="margin-top:0.6rem;"></div>
    </div>

    <div class="card">
      <h2>3Ô∏è‚É£ Find Recipes</h2>
      <div class="row">
        <select id="diet">
          <option value="none">No dietary filter</option>
          <option value="vegetarian">Vegetarian only</option>
        </select>
        <button id="findBtn">Find Recipes</button>
      </div>
      <div id="results" style="margin-top:1rem;"></div>
    </div>
  </div>

<script>
/* Minimal recipe DB */
const RECIPES = [
  {title:"Tomato Pasta",ingredients:["pasta","tomato","garlic","olive oil"],nut:{cal:480,prot:12},time:20},
  {title:"Chana Masala",ingredients:["chickpeas","tomato","onion","garam masala"],nut:{cal:380,prot:14},time:35},
  {title:"Veg Stir Fry",ingredients:["broccoli","carrot","soy sauce","garlic"],nut:{cal:260,prot:7},time:15},
  {title:"Egg Fried Rice",ingredients:["rice","egg","soy sauce","spring onion"],nut:{cal:520,prot:15},time:20},
  {title:"Paneer Curry",ingredients:["paneer","tomato","onion","garam masala"],nut:{cal:600,prot:20},time:30},
  {title:"Chicken Salad",ingredients:["chicken","lettuce","tomato","olive oil"],nut:{cal:350,prot:28},time:15}
];
const SUBS = {egg:["flaxseed"],milk:["almond milk","soy milk"],chicken:["tofu"],paneer:["tofu"]};

let ingredients = [];
const el = id => document.getElementById(id);
function renderIngredients(){
  el('ings').innerHTML = ingredients.length
    ? ingredients.map(i=>`<span class='badge'>${i}</span>`).join('')
    : "<small>No ingredients yet.</small>";
}
function jaccard(a,b){
  const A=new Set(a.map(s=>s.toLowerCase())), B=new Set(b.map(s=>s.toLowerCase()));
  const inter=[...A].filter(x=>B.has(x)).length;
  const uni=new Set([...A,...B]).size;
  return uni?inter/uni:0;
}
el('addBtn').onclick = ()=>{
  const v = el('ingAdd').value.trim().toLowerCase();
  if(v && !ingredients.includes(v)) ingredients.push(v);
  el('ingAdd').value=''; renderIngredients();
};
el('clearBtn').onclick = ()=>{ ingredients=[]; renderIngredients(); el('labels').innerText=''; };
el('findBtn').onclick = ()=>{
  const diet = el('diet').value;
  const meats = ['chicken','beef','pork','fish'];
  const filtered = diet==='vegetarian'?RECIPES.filter(r=>!r.ingredients.some(i=>meats.includes(i))):RECIPES;
  const scored = filtered.map(r=>({r,score:jaccard(ingredients,r.ingredients)})).sort((a,b)=>b.score-a.score);
  const out = scored.map(s=>{
    const miss = s.r.ingredients.filter(i=>!ingredients.includes(i));
    const subs = miss.map(m=>SUBS[m] ? SUBS[m].join(', ') : '-').join(' | ');
    return `<div class='recipe'>
      <h3>${s.r.title} (${Math.round(s.score*100)}%)</h3>
      <small><b>Ingredients:</b> ${s.r.ingredients.join(', ')}</small><br>
      <small><b>Missing:</b> ${miss.join(', ')||'None'}</small><br>
      <small><b>Substitutions:</b> ${subs||'-'}</small><br>
      <small><b>Time:</b> ${s.r.time} min ‚Ä¢ <b>Calories:</b> ${s.r.nut.cal} ‚Ä¢ <b>Protein:</b> ${s.r.nut.prot}g</small>
    </div>`;
  }).join('') || "<small>No matching recipes found.</small>";
  el('results').innerHTML = out;
};

/* TensorFlow.js ingredient recognition */
let model=null;
async function loadModel(){ model = await mobilenet.load(); }
loadModel();
el('photo').addEventListener('change', async e=>{
  const f = e.target.files[0]; if(!f) return;
  el('labels').innerText='Analyzing...';
  const img = document.createElement('img');
  img.src = URL.createObjectURL(f);
  await new Promise(r=>img.onload=r);
  if(!model) await loadModel();
  const preds = await model.classify(img,3);
  const mapped = preds.map(p=>p.className.split(',')[0].toLowerCase());
  el('labels').innerHTML = `<b>Detected:</b> ${mapped.join(', ')}`;
  mapped.forEach(m=>{ if(!ingredients.includes(m)) ingredients.push(m); });
  renderIngredients();
});
</script>
</body>
</html>
